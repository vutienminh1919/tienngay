!function(t){var e={};function a(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,a),o.l=!0,o.exports}a.m=t,a.c=e,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)a.d(n,o,function(e){return t[e]}.bind(null,o));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/",a(a.s=0)}([function(t,e,a){a(1),a(18),a(23),a(25),a(27),a(29),a(31),a(33),a(35),a(37),a(39),t.exports=a(41)},function(t,e){$(document).ajaxStart((function(){$("#loading").show();var t=window.screen.height;$("#loading, .right-col iframe").css("height",t)})).ajaxStop((function(){$("#loading").hide()})),$(document).ready((function(){function t(){this.initData={},this.objJson={},this.current_page=1,this.records_per_page=15,this.selectedIds=[];this.init=function(t){this.initData=t;var e=Object.keys(t).map((function(e){return[Number(e),t[e]]}));this.objJson=e.sort((function(t,e){var a=t[0].updated_at,n=e[0].updated_at;return new Date(a)>new Date(n)?1:-1})),console.log(this.objJson),this.createPanigation(),this.changePage(1),$("#select-all").on("click",this.selectAll.bind(this))},this.selectAll=function(t){var e=[];$(".selected_item").prop("checked",t.target.checked),this.objJson.forEach((function(a,n){a[1].selected=t.target.checked,t.target.checked&&e.push(a[1].id)})),this.selectedIds=e},this.selectItem=function(t){var e=$(t.target).attr("data-no");if(this.objJson[e][1].selected=t.target.checked,t.target.checked&&-1===this.selectedIds.indexOf(this.objJson[e][1].id))this.selectedIds.push(this.objJson[e][1].id);else{var a=this.selectedIds.indexOf(this.objJson[e][1].id);a>-1&&this.selectedIds.splice(a,1)}},this.prevPage=function(){console.log(this.current_page),this.current_page>1&&(this.current_page--,this.changePage(this.current_page)),console.log(this.current_page)},this.nextPage=function(){console.log(this.current_page),this.current_page<this.numPages()&&(this.current_page++,this.changePage(this.current_page)),console.log(this.current_page)},this.changePage=function(t){var e=document.getElementById("btn_prev"),a=document.getElementById("btn_next"),n=document.getElementById("listingTable"),o=document.getElementById("page");t<1&&(t=1),t>this.numPages()&&(t=this.numPages()),this.current_page=t,n.innerHTML="";for(var r=(t-1)*this.records_per_page;r<t*this.records_per_page;r++)this.objJson[r]&&(n.innerHTML+=this.createEL(this.objJson[r][1],r));if(o.innerHTML=t+"/"+this.numPages(),1==t?e.classList.add("disabled"):e.classList.remove("disabled"),t==this.numPages()?a.classList.add("disabled"):a.classList.remove("disabled"),$(".page-number.active").removeClass("active"),$("[data-page="+t+"]").parent().addClass("active"),$(".selected_item").on("click",this.selectItem.bind(this)),this.numPages()>10){var i=0,s=0;this.numPages()-Number(t)<Number(5)?i=Number(t)-2*Number(5)+(this.numPages()-Number(t)):(i=Number(t)-Number(5))<1&&(i=1),Number(t)-Number(i)<Number(5)?s=Number(t)+2*Number(5)-(Number(t)-Number(i)):(s=Number(t)+Number(5))>this.numPages()&&(s=this.numPages()),$(".page-number").addClass("hide-item");for(var c=i;c<=s;c++)$("[data-page="+c+"]").parent().removeClass("hide-item"),$("[data-page="+c+"]").text($("[data-page="+c+"]").attr("data-page"));$("[data-page="+Number(i-1)+"]").parent().removeClass("hide-item"),$("[data-page="+Number(i-1)+"]").text("..."),$("[data-page="+Number(s+1)+"]").parent().removeClass("hide-item"),$("[data-page="+Number(s+1)+"]").text("...")}},this.numPages=function(){return Math.ceil(this.objJson.length/this.records_per_page)},this.reconciliation=function(){for(var t=[],e=!1,n=0;n<this.objJson.length;n++)this.objJson[n][1].selected&&(e=!0),this.objJson[n][1].selected&&null==this.objJson[n][1].transaction_reconciliation_id&&2==this.objJson[n][1].status&&t.push(this.objJson[n][1].id);console.log(t),t.length>0?$.ajax({type:"POST",url:createReconciliationUrl,data:{selectedIds:t,_token:a},success:function(t){console.log(t),200==t.status?(console.log(t.data),$("#reconciliation-success").find(".msg_success").text(t.message),$("#reconciliation-success").find("a#details").attr("href",t.url),$("#reconciliation-success").show()):($("#errorModal").find(".msg_error").text(t.message),$("#errorModal").show())},error:function(t,e){var a="";a=0===t.status?"Not connect.\n Verify Network.":404==t.status?"Requested page not found. [404]":500==t.status?"Internal Server Error [500].":"parsererror"===e?"Requested JSON parse failed.":"timeout"===e?"Time out error.":"abort"===e?"Ajax request aborted.":"Uncaught Error.\n"+t.responseText,$("#errorModal").find(".msg_error").text(a),$("#errorModal").show()}}):(e?$("#errorModal").find(".msg_error").text("Giao dịch chọn đã được đối soát bổ sung trước đó hoặc chưa được thanh toán"):$("#errorModal").find(".msg_error").text("Chưa có giao dịch nào được chọn"),$("#errorModal").show())},this.reconciliationConfirm=function(){console.log(this.selectedIds);var t=this.selectedIds;this.selectedIds.length>0?$.ajax({type:"POST",url:autoConfirmUrl,data:{ids:t,_token:a},success:this.updateConfirmed(t)}).done((function(){$("#successModal").show()})):($("#errorModal").find(".msg_error").text("Chưa có giao dịch nào được chọn"),$("#errorModal").show())},this.exportExcel=function(){for(var t="",e=1,a=[],n=0;n<this.objJson.length;n++)this.objJson[n][1].selected&&(t+="<tr>"+this.createEL(this.objJson[n][1],e,!0)+"</tr>",e++,a.push(this.objJson[n][1].id));var o=$("#clone-object").clone();o.find("#listingTable").html($.parseHTML(t)),o.find("th:last-child, td:last-child").hide(),o.table2excel({exclude:".no-export",name:"Worksheet Name",filename:"transactions.xls",preserveColors:!1})},this.updateConfirmed=function(t){for(var e=0;e<this.objJson.length;e++)t.includes(this.objJson[e][1].id)&&(this.objJson[e][1].confirmed=2);this.changePage(this.current_page)},this.printData=function(){for(var t="",e=1,a=0;a<this.objJson.length;a++)this.objJson[a][1].selected&&(t+="<tr>"+this.createEL(this.objJson[a][1],e,!0)+"</tr>",e++);var n=$("#clone-object").clone();n.find("#listingTable").html($.parseHTML(t)),n.removeAttr("hidden"),n.find("th:last-child, td:last-child").hide();var o=window.open();o.document.write(n.prop("outerHTML")),o.print(),o.close()},this.createEL=function(t,e){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=$("#transaction-item").clone();return n.attr("id","transaction-"+t.id),n.attr("data-id",t.id),n.find("[data-attr='selected_item']").val(t.id),a?n.find("[data-attr='transaction_no']").text(e):n.find("[data-attr='selected_item']").attr("data-no",e),t.selected?n.find("[data-attr='selected_item']").attr("checked",!0):n.find("[data-attr='selected_item']").attr("checked",!1),n.find("[data-attr='transactionId']").text(t.transactionId),a?(n.find("[data-attr='paid_amount']").addClass("col-number"),n.find("[data-attr='paid_amount']").text(t.paid_amount)):n.find("[data-attr='paid_amount']").text(this.fomatNumber(t.paid_amount)),n.find("[data-attr='name']").text(t.name),console.log(t.contract_code),null==t.contract_code?n.find("[data-attr='contract_code']").text(""):a?n.find("[data-attr='contract_code']").text("'"+t.contract_code):n.find("[data-attr='contract_code']").text(t.contract_code),1==t.client_code?n.find("[data-attr='client_code']").text("App KH (Ios)"):2==t.client_code?n.find("[data-attr='client_code']").text("App KH (Android)"):3==t.client_code?n.find("[data-attr='client_code']").text("App KH (Web)"):n.find("[data-attr='client_code']").text("App Momo"),n.find("[data-attr='contract_code_disbursement']").text(t.contract_code_disbursement),n.find("[data-attr='paid_date']").text(t.paid_date),n.find("[data-attr='payment_option']").text(t.payment_option),1==t.payment_option?n.find("[data-attr='payment_option']").text("Thanh toán kỳ"):2==t.payment_option?n.find("[data-attr='payment_option']").text("Tất toán"):3==t.payment_option?n.find("[data-attr='payment_option']").text("NĐT"):n.find("[data-attr='payment_option']").text(""),a?(n.find("[data-attr='transaction_fee']").addClass("col-number"),n.find("[data-attr='transaction_fee']").text(t.transaction_fee)):n.find("[data-attr='transaction_fee']").text(this.fomatNumber(t.transaction_fee)),1==t.payment_option||2==t.payment_option?1==t.contract_status?n.find("[data-attr='contract_status']").text("Đang xử lý"):2==t.contract_status?n.find("[data-attr='contract_status']").text("Đã trừ tiền kỳ"):n.find("[data-attr='contract_status']").text("Thất bại"):n.find("[data-attr='contract_status']").text(""),1==t.status?n.find("[data-attr='status']").text("Chưa thanh toán"):2==t.status?n.find("[data-attr='status']").text("Đã thanh toán"):n.find("[data-attr='status']").text(""),1==t.confirmed?n.find("[data-attr='confirmed']").text("Chưa đối soát"):2==t.confirmed?n.find("[data-attr='confirmed']").text("Đã đối soát"):n.find("[data-attr='confirmed']").text("Unknown"),n.find("#details-show-info__id__").attr("data-id",t.id),n.find("#details-show-info__id__").attr("href","transaction/"+t.id),n.html()},this.createPanigation=function(){$("li.page-number").remove();for(var t=1;t<=this.numPages();t++)1==t?$("<li class='page-item page-number active'><a class='page-link' data-page='"+t+"' href='javascript:void(0);'>"+t+"</a></li>").insertBefore("#btn_next"):$("<li class='page-item page-number'><a class='page-link' data-page='"+t+"' href='javascript:void(0);'>"+t+"</a></li>").insertBefore("#btn_next")},this.fomatNumber=function(t){return(new Intl.NumberFormat).format(t)}}var e=new t,a=$('[name="_token"]').val();function n(a){e&&(e=null),e=new t,console.log("initPage ",a),e.init(a),$("#btn_prev").off().on("click",(function(){e.prevPage()})),$("#btn_next").off().on("click",(function(){e.nextPage()})),$(".pagination").off().on("click",".page-number",(function(){var t=event.target;e.changePage($(t).attr("data-page"))}))}n(transactions);$("#start-date, #end-date").datepicker({format:"yyyy-mm-dd",autoclose:!0});$("#select-time").datepicker({format:"yyyy-mm",startView:"months",minViewMode:"months",autoclose:!0}).on("change",(function(t){var e=$("#select-time").val();console.log(getListByMonthUrl);var o={time:e,_token:a};$.ajax({type:"POST",url:getListByMonthUrl,data:o,success:function(t){console.log(t),200==t.status?(console.log(t.data),n(t.data.data),$("#total_transaction").text(t.data.totalTransaction),$("#total_paid_amount").text(t.data.totalPaidAmount),$("#total_transaction_fee").text(t.data.totalTransactionFee)):($("#errorModal").find(".msg_error").text(t.message),$("#errorModal").show())},error:function(t,e){0===t.status||(404==t.status||(500==t.status||("parsererror"===e||("timeout"===e||("abort"===e||t.responseText))))),$("#errorModal").show()}})})),$(".close").on("click",(function(t){$("#errorModal").hide()})),$("#submit-data").on("click",(function(t){t.preventDefault(),$("#submit-data").prop("disabled",!0);var e=$("#search-form"),a=e.attr("action");console.log(a),$.ajax({type:"POST",url:a,data:e.serialize(),success:function(t){console.log(t),200==t.status?(console.log(t.data),n(t.data.data),$("#total_transaction").text(t.data.totalTransaction),$("#total_paid_amount").text(t.data.totalPaidAmount),$("#total_transaction_fee").text(t.data.totalTransactionFee)):($("#errorModal").find(".msg_error").text(t.message),$("#errorModal").show()),$("#submit-data").prop("disabled",!1),$("#fillter-content").hide()},error:function(t,e){var a="";a=0===t.status?"Not connect.\n Verify Network.":404==t.status?"Requested page not found. [404]":500==t.status?"Internal Server Error [500].":"parsererror"===e?"Requested JSON parse failed.":"timeout"===e?"Time out error.":"abort"===e?"Ajax request aborted.":"Uncaught Error.\n"+t.responseText,$("#submit-data").prop("disabled",!1),$("#errorModal").find(".msg_error").text(a),$("#errorModal").show()}})})),$("#print-data").on("click",(function(t){t.preventDefault(),e.printData()})),$("#export-excel").on("click",(function(t){t.preventDefault(),e.exportExcel()})),$("#reconciliation-data").on("click",(function(t){t.preventDefault(),$("#modal-confirm").show()})),$("#cancel").on("click",(function(t){t.preventDefault(),$("#modal-confirm").hide()})),$("#create-reconciliation").on("click",(function(t){t.preventDefault(),$("#modal-confirm").hide(),e.reconciliation()})),$("#reconciliation-confirm").on("click",(function(t){t.preventDefault(),e.reconciliationConfirm()}))}))},,,,,,,,,,,,,,,,,function(t,e){},,,,,function(t,e){},,function(t,e){},,function(t,e){},,function(t,e){},,function(t,e){},,function(t,e){},,function(t,e){},,function(t,e){},,function(t,e){},,function(t,e){}]);
